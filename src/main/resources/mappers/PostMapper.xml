<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.playground.mapper.PostMapper">

  <resultMap id="postResultMap" type="com.playground.vo.PostVO">
    <id property="postId" column="post_id"/>
    <result property="memberId" column="member_id"/>
    <result property="title" column="title"/>
    <result property="content" column="content"/>
    <result property="viewCount" column="view_count"/>
    <result property="postCreatedAt" column="created_at"/>
    <result property="postUpdatedAt" column="updated_at"/>
    <result property="writerNickname" column="writer_nickname"/>
  </resultMap>

  <insert id="insertPost" parameterType="com.playground.vo.PostVO">
    INSERT INTO post (title, content, member_id)
    VALUES (#{title}, #{content}, #{memberId})
  </insert>

  <select id="selectPostById" resultMap="postResultMap">
    SELECT p.*, m.nickname as writer_nickname
    FROM post p
           JOIN member m ON p.member_id = m.member_id
    WHERE p.post_id = #{postId}
  </select>

  <select id="selectAllPosts" resultMap="postResultMap">
    SELECT p.*, m.nickname as writer_nickname
    FROM post p
           JOIN member m ON p.member_id = m.member_id
    ORDER BY p.post_id DESC
      LIMIT #{limit} OFFSET #{offset}
  </select>

  <select id="countAllPosts" resultType="int">
    SELECT COUNT(*) FROM post
  </select>

  <update id="updatePost" parameterType="com.playground.vo.PostVO">
    UPDATE post
    SET title = #{title}, content = #{content}
    WHERE post_id = #{postId}
  </update>

  <delete id="deletePost">
    DELETE FROM post WHERE post_id = #{postId}
  </delete>

  <update id="incrementViewCount">
    UPDATE post
    SET view_count = view_count + 1
    WHERE post_id = #{postId}
  </update>

</mapper>